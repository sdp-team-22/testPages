<div class="search-container" *ngIf="!showAdvancedSearch">
    <input type="text" placeholder="Search by Compound Name" class="search-input" [(ngModel)]="searchQuery" (keyup.enter)="basicSearch()">
    <button mat-raised-button class="search-button" (click)="basicSearch()">Search</button>
</div>
<button mat-raised-button class="advanced-button" *ngIf="!showAdvancedSearch" (click)="toggleAdvancedSearch(); resetSearch()">Advanced Search</button>

<div *ngIf="searchResults.length > 0">
    <mat-form-field>
      <mat-label>Select Fraction:</mat-label>
      <mat-select [(ngModel)]="selectedFraction">
        <mat-option value="volfrac">Volume Fraction</mat-option>
        <mat-option value="wtfrac">Weight Fraction</mat-option>
      </mat-select>
    </mat-form-field>
  
    <mat-form-field>
      <mat-label>Select Solubility Unit:</mat-label>
      <mat-select [(ngModel)]="selectedUnit">
        <mat-option value="solubility_mg_g_solvn">mg/g solvent</mat-option>
        <mat-option value="solubility_mg_g_solv">mg/g soln</mat-option>
        <mat-option value="solubility_mg_mL_solv">mg/mL solvent</mat-option>
        <mat-option value="solubility_wt">Solubility wt</mat-option>
      </mat-select>
    </mat-form-field>
    <table mat-table [dataSource]="searchResults">
        <!-- checkbox Column -->
        <ng-container matColumnDef="select">
          <th mat-header-cell *matHeaderCellDef>Select All
            <mat-checkbox color ="primary" class ="checkbox" (change)="toggleSelectAll1($event)"></mat-checkbox>
          </th>
          <td mat-cell *matCellDef="let result">
            <mat-checkbox color ="primary" class ="checkbox" [(ngModel)]="result.selected" (change)="onCheckboxChange($event, result)"></mat-checkbox>
          </td>
        </ng-container>
      <!-- Compound Name Column -->
      <ng-container matColumnDef="compound_name">
        <th mat-header-cell *matHeaderCellDef> Compound Name </th>
        <td mat-cell *matCellDef="let result"> {{ result.compound_name }} </td>
      </ng-container>
  
      <!-- Solubility Column -->
      <ng-container matColumnDef="solubility">
        <th mat-header-cell *matHeaderCellDef> Solubility </th>
        <td mat-cell *matCellDef="let result">
          <ng-container *ngIf="selectedUnit === 'solubility_mg_g_solvn'"> {{ result.solubility_mg_g_solvn }} </ng-container>
          <ng-container *ngIf="selectedUnit === 'solubility_mg_g_solv'"> {{ result.solubility_mg_g_solv }} </ng-container>
          <ng-container *ngIf="selectedUnit === 'solubility_mg_mL_solv'"> {{ result.solubility_mg_mL_solv }} </ng-container>
          <ng-container *ngIf="selectedUnit === 'solubility_wt'"> {{ result.solubility_wt }} </ng-container>
        </td>
      </ng-container>
  
      <!-- Fraction Column -->
      <ng-container matColumnDef="fraction">
        <th mat-header-cell *matHeaderCellDef> Fraction </th>
        <td mat-cell class="mat-cell" *matCellDef="let result">
          <ng-container *ngIf="selectedFraction === 'volfrac'">
            <div *ngIf="result.solvent_1 !== undefined && !isNaN(result.volfrac1)">
                {{ result.solvent_1 }} Volume Fraction: {{ result.volfrac1 }}
            </div>
            <div *ngIf="result.solvent_2 !== undefined && result.solvent_2 !== '' ">
                {{ result.solvent_2 }} Volume Fraction: {{ result.volfrac2 }}
            </div>
            <div *ngIf="result.solvent_3 !== undefined && result.solvent_3 !== '' ">
                {{ result.solvent_3 }} Volume Fraction: {{ result.volfrac3 }}
            </div>
          </ng-container>
          <ng-container *ngIf="selectedFraction === 'wtfrac'">
            <div *ngIf="result.solvent_1 !== undefined && result.solvent_1 !== '' ">
                {{ result.solvent_1 }} Weight Fraction: {{ result.wtfrac1 }}
            </div>
            <div *ngIf="result.solvent_2 !== undefined && result.solvent_2 !== '' ">
                {{ result.solvent_2 }} Weight Fraction: {{ result.wtfrac2 }}
            </div>
            <div *ngIf="result.solvent_3 !== undefined && result.solvent_3 !== '' ">
                {{ result.solvent_3 }} Weight Fraction: {{ result.wtfrac3 }}
            </div>
          </ng-container>
        </td>
      </ng-container>
      <!-- temp Column -->
      <ng-container matColumnDef="temp">
        <th mat-header-cell *matHeaderCellDef> Temp &#8451; </th>
        <td mat-cell *matCellDef="let result"> {{ result.temp }} </td>
      </ng-container>
      <!-- solid form Column -->
      <ng-container matColumnDef="xrpd">
        <th mat-header-cell *matHeaderCellDef> Solid Form </th>
        <td mat-cell *matCellDef="let result"> {{ result.xrpd }} </td>
      </ng-container>
      <!-- Scientist Name Column -->
      <ng-container matColumnDef="scientist_name">
        <th mat-header-cell *matHeaderCellDef> Scientist Name </th>
        <td mat-cell *matCellDef="let result"> {{ result.scientist_name }} </td>
      </ng-container>
      <!-- Solute Lot Number Column -->
      <ng-container matColumnDef="solute_lot_num">
        <th mat-header-cell *matHeaderCellDef> Solute Lot Number </th>
        <td mat-cell *matCellDef="let result"> {{ result.solute_lot_num }} </td>
      </ng-container>
      <!-- eln sample Column -->
      <ng-container matColumnDef="eln_sample_num_measure">
        <th mat-header-cell *matHeaderCellDef> ELN Sample Number</th>
        <td mat-cell *matCellDef="let result"> {{ result.eln_sample_num_measure}} </td>
      </ng-container>
      <!-- file name Column -->
      <ng-container matColumnDef="file_name">
        <th mat-header-cell *matHeaderCellDef> File Name </th>
        <td mat-cell *matCellDef="let result"> {{ result.file_name }} </td>
      </ng-container>
      <!-- Define table columns -->
      <tr mat-header-row *matHeaderRowDef="['select','compound_name', 'solubility', 'fraction', 'temp', 'xrpd', 'scientist_name', 'solute_lot_num', 'eln_sample_num_measure', 'file_name',]"></tr>
      <tr mat-row *matRowDef="let row; columns: ['select', 'compound_name', 'solubility', 'fraction', 'temp', 'xrpd', 'scientist_name', 'solute_lot_num', 'eln_sample_num_measure', 'file_name',];"></tr>
    </table>
    <div id="download-button" class="download-container">
      <button mat-raised-button class="download-button" (click)="exportToExcel(selectedItems)">Download</button>
    </div>
    <div class="graph-container">
      <mat-form-field appearance="fill">
        <mat-label>Graph Type</mat-label>
        <mat-select [(ngModel)]="selectedGraphType" name="selectedGraphType">
          <mat-option  (click)="showGraph()" value="bar">Bar Graph</mat-option>
          <mat-option  (click)="showGraph()" value="scatter">Scatter Plot</mat-option>
        </mat-select>
      </mat-form-field>
      <!-- <button mat-raised-button class="graph-button" (click)="showGraph()">Graph It</button> -->
    </div>
    <canvas id="chartCanvas"></canvas>
</div>
<button mat-raised-button class="advanced-button" *ngIf="showAdvancedSearch" (click)="toggleAdvancedSearch(); clearSearch()">Go back to basic search?</button>
<div class="advanced-container" *ngIf="showAdvancedSearch">
    <form (ngSubmit)="advancedSearch()">
        <div class="filter-container" *ngFor="let filter of filters; let i = index">
          <mat-form-field appearance="fill">
            <mat-label>Filter {{i+1}}</mat-label>
            <mat-select [(ngModel)]="filter.field" name="field"
                        [ngModelOptions]="{standalone: true}" >
                <mat-option value="compound_name">Compound Name</mat-option>
                <mat-option value="xrpd">Solid Form</mat-option>
                <mat-option value="solvent">Solvent</mat-option>
            </mat-select>
        </mat-form-field>
            
            <!-- Display input fields based on selected criterion -->
            <div class="input-container">
              <mat-form-field appearance="fill" *ngIf="filter.field === 'compound_name'">
                <mat-label>Compound Name</mat-label>
                <input matInput
                       placeholder="Pick one"
                       aria-label="Compound Name"
                       [matAutocomplete]="auto"
                       [(ngModel)]="filter.compound_name"
                       [formControl] = "myControl"
                       [name]="'compound_name' + i">
                <mat-autocomplete #auto="matAutocomplete">
                    <mat-option *ngFor="let option of filteredOptions | async" [value]="option">
                        {{ option }}
                    </mat-option>
                </mat-autocomplete>
              </mat-form-field>
            
                <mat-form-field appearance="fill" *ngIf="filter.field === 'xrpd'">
                    <mat-label>Solid Form</mat-label>
                    <mat-select placeholder="Select Solid Form" [(ngModel)]="filter.xrpd" name="xrpd{{i}}">
                      <mat-option *ngFor="let option of xrpdOptions" [value]="option">{{ option }}</mat-option>
                    </mat-select>
                </mat-form-field>

                <mat-form-field appearance="fill" *ngIf="filter.field === 'solvent'">
                  <mat-label>Solvent</mat-label>
                  <mat-select placeholder="Select Solvent match" [(ngModel)]="filter.solventMatch" name="solventMatch{{i}}">
                      <mat-option value="contains">Contains</mat-option>
                      <mat-option value="exact">Exact</mat-option>
                  </mat-select>
                </mat-form-field>

              <div *ngIf="filter.solventMatch === 'contains'">
                <mat-form-field appearance="fill" *ngIf="filter.field === 'solvent'">
                  <mat-label>Solvent 1</mat-label>
                  <input matInput
                         type="text"
                         [(ngModel)]="filter.solvent_1"
                         name="solvent_1{{i}}"
                         [formControl] = "solvent1Control"
                         [matAutocomplete]="solvent1Auto">
                  <mat-autocomplete #solvent1Auto>
                    <mat-option *ngFor="let option of filterSolvent1 | async" [value]="option">{{ option }}</mat-option>
                  </mat-autocomplete>
                </mat-form-field>
                
                <!-- Solvent 2 -->
                <mat-form-field appearance="fill" *ngIf="filter.field === 'solvent'">
                  <mat-label>Solvent 2</mat-label>
                  <input matInput
                         type="text"
                         [(ngModel)]="filter.solvent_2"
                         name="solvent_2{{i}}"
                         [formControl] = "solvent2Control"
                         [matAutocomplete]="solvent2Auto">
                  <mat-autocomplete #solvent2Auto>
                    <mat-option *ngFor="let option of filterSolvent2 | async" [value]="option">{{ option }}</mat-option>
                  </mat-autocomplete>
                </mat-form-field>
                
                <!-- Solvent 3 -->
                <mat-form-field appearance="fill" *ngIf="filter.field === 'solvent'">
                  <mat-label>Solvent 3</mat-label>
                  <input matInput
                         type="text"
                         [(ngModel)]="filter.solvent_3"
                         name="solvent_3{{i}}"
                         [formControl] = "solvent3Control"
                         [matAutocomplete]="solvent3Auto">
                  <mat-autocomplete #solvent3Auto>
                    <mat-option *ngFor="let option of filterSolvent3 | async" [value]="option">{{ option }}</mat-option>
                  </mat-autocomplete>
                </mat-form-field>
              </div>
              <div *ngIf="filter.solventMatch === 'exact'">
                <!-- Solvent 1 -->
                <mat-form-field appearance="fill" *ngIf="filter.field === 'solvent'">
                  <mat-label>Solvent 1</mat-label>
                  <input matInput
                         type="text"
                         [(ngModel)]="filter.solvent_1"
                         name="solvent_1{{i}}"
                         [matAutocomplete]="solvent1Auto">
                  <mat-autocomplete #solvent1Auto>
                    <mat-option *ngFor="let option of solvent1_Options" [value]="option">{{ option }}</mat-option>
                  </mat-autocomplete>
                </mat-form-field>
                
                <!-- Solvent 2 -->
                <mat-form-field appearance="fill" *ngIf="filter.field === 'solvent'">
                  <mat-label>Solvent 2</mat-label>
                  <input matInput
                         type="text"
                         [(ngModel)]="filter.solvent_2"
                         name="solvent_2{{i}}"
                         [matAutocomplete]="solvent2Auto">
                  <mat-autocomplete #solvent2Auto>
                    <mat-option *ngFor="let option of solvent2_Options" [value]="option">{{ option }}</mat-option>
                  </mat-autocomplete>
                </mat-form-field>
                
                <!-- Solvent 3 -->
                <mat-form-field appearance="fill" *ngIf="filter.field === 'solvent'">
                  <mat-label>Solvent 3</mat-label>
                  <input matInput
                         type="text"
                         [(ngModel)]="filter.solvent_3"
                         name="solvent_3{{i}}"
                         [matAutocomplete]="solvent3Auto">
                  <mat-autocomplete #solvent3Auto>
                    <mat-option *ngFor="let option of solvent3_Options" [value]="option">{{ option }}</mat-option>
                  </mat-autocomplete>
                </mat-form-field>
              </div>
            </div>
            <button mat-raised-button class="clear-button" type="button" (click)="removeFilter(i)">
                <mat-icon>clear</mat-icon>
            </button>
        </div>
            <div>
                <button mat-raised-button class="add-button" type="button" (click)="addFilter()">Add Filter</button>
                <button mat-raised-button class="add-button" type="button" (click)="clearSearch()">Reset</button>
                <button mat-raised-button class="search-button" type="submit">Search</button>
            </div>
    </form>
    

    <div *ngIf="searchResults2.length > 0">
        <mat-form-field>
          <mat-label>Select Fraction:</mat-label>
          <mat-select [(ngModel)]="selectedFraction">
            <mat-option value="volfrac">Volume Fraction</mat-option>
            <mat-option value="wtfrac">Weight Fraction</mat-option>
          </mat-select>
        </mat-form-field>
      
        <mat-form-field>
          <mat-label>Select Solubility Unit:</mat-label>
          <mat-select [(ngModel)]="selectedUnit">
            <mat-option value="solubility_mg_g_solvn">mg/g solvent</mat-option>
            <mat-option value="solubility_mg_g_solv">mg/g soln</mat-option>
            <mat-option value="solubility_mg_mL_solv">mg/mL solvent</mat-option>
            <mat-option value="solubility_wt">Solubility wt</mat-option>
          </mat-select>
        </mat-form-field>
      
        <table mat-table [dataSource]="searchResults2">
          <!-- checkbox Column -->
          <ng-container matColumnDef="select">
            <th mat-header-cell *matHeaderCellDef>Select All
              <mat-checkbox color ="primary" class ="checkbox" (change)="toggleSelectAll2($event)"></mat-checkbox>

            </th>
            <td mat-cell *matCellDef="let result">
              <mat-checkbox color ="primary" class ="checkbox" [(ngModel)]="result.selected" (change)="onCheckboxChange($event, result)"></mat-checkbox>
            </td>
          </ng-container>
          <!-- Compound Name Column -->
          <ng-container matColumnDef="compound_name">
            <th mat-header-cell *matHeaderCellDef> Compound Name </th>
            <td mat-cell *matCellDef="let result"> {{ result.compound_name }} </td>
          </ng-container>
    
          <!-- Solubility Column -->
          <ng-container matColumnDef="solubility">
            <th mat-header-cell *matHeaderCellDef> Solubility </th>
            <td mat-cell *matCellDef="let result">
              <ng-container *ngIf="selectedUnit === 'solubility_mg_g_solvn'"> {{ result.solubility_mg_g_solvn }} </ng-container>
              <ng-container *ngIf="selectedUnit === 'solubility_mg_g_solv'"> {{ result.solubility_mg_g_solv }} </ng-container>
              <ng-container *ngIf="selectedUnit === 'solubility_mg_mL_solv'"> {{ result.solubility_mg_mL_solv }} </ng-container>
              <ng-container *ngIf="selectedUnit === 'solubility_wt'"> {{ result.solubility_wt }} </ng-container>
            </td>
          </ng-container>
      
          <!-- Fraction Column -->
          <ng-container matColumnDef="fraction">
            <th mat-header-cell *matHeaderCellDef> Fraction </th>
            <td mat-cell class="mat-cell" *matCellDef="let result">
              <ng-container *ngIf="selectedFraction === 'volfrac'">
                  <div *ngIf="result.solvent_1 !== undefined && result.solvent_1 !== '' ">
                    {{ result.solvent_1 }} Volume Fraction: {{ result.volfrac1 }}
                  </div>
                  <div *ngIf="result.solvent_2 !== undefined && result.solvent_2 !== '' ">
                      {{ result.solvent_2 }} Volume Fraction: {{ result.volfrac2 }}
                  </div>
                  <div *ngIf="result.solvent_3 !== undefined && result.solvent_3 !== '' ">
                      {{ result.solvent_3 }} Volume Fraction: {{ result.volfrac3 }}
                  </div>
              </ng-container>
              <ng-container *ngIf="selectedFraction === 'wtfrac'">
                <div *ngIf="result.solvent_1 !== undefined && result.solvent_1 !== '' ">
                  {{ result.solvent_1 }} Weight Fraction: {{ result.wtfrac1 }}
                </div>
                <div *ngIf="result.solvent_2 !== undefined && result.solvent_2 !== '' ">
                    {{ result.solvent_2 }} Weight Fraction: {{ result.wtfrac2 }}
                </div>
                <div *ngIf="result.solvent_3 !== undefined && result.solvent_3 !== '' ">
                    {{ result.solvent_3 }} Weight Fraction: {{ result.wtfrac3 }}
                </div>
              </ng-container>
            </td>
            <!-- Temp Column -->
          </ng-container>
          <ng-container matColumnDef="temp">
            <th mat-header-cell *matHeaderCellDef> Temp &#8451; </th>
            <td mat-cell *matCellDef="let result"> {{ result.temp }} </td>
          </ng-container>
          <!-- solid form  Column -->
          <ng-container matColumnDef="xrpd">
            <th mat-header-cell *matHeaderCellDef> Solid Form </th>
            <td mat-cell *matCellDef="let result"> {{ result.xrpd }} </td>
          </ng-container>
          <!-- Scientist Name Column -->
          <ng-container matColumnDef="scientist_name">
            <th mat-header-cell *matHeaderCellDef> Scientist Name </th>
            <td mat-cell *matCellDef="let result"> {{ result.scientist_name }} </td>
          </ng-container>
          <!-- Solute Lot Number Column -->
          <ng-container matColumnDef="solute_lot_num">
            <th mat-header-cell *matHeaderCellDef> Solute Lot Number </th>
            <td mat-cell *matCellDef="let result"> {{ result.solute_lot_num }} </td>
          </ng-container>
          <!-- eln sample Column -->
          <ng-container matColumnDef="eln_sample_num_measure">
            <th mat-header-cell *matHeaderCellDef> ELN Sample Number</th>
            <td mat-cell *matCellDef="let result"> {{ result.eln_sample_num_measure}} </td>
          </ng-container>
          <!-- file name Column -->
          <ng-container matColumnDef="file_name">
            <th mat-header-cell *matHeaderCellDef> File Name </th>
            <td mat-cell *matCellDef="let result"> {{ result.file_name }} </td>
          </ng-container>
          <!-- Define table columns -->
          <tr mat-header-row *matHeaderRowDef="['select','compound_name', 'solubility', 'fraction', 'temp', 'xrpd', 'scientist_name', 'solute_lot_num', 'eln_sample_num_measure', 'file_name',]"></tr>
          <tr mat-row *matRowDef="let row; columns: ['select', 'compound_name', 'solubility', 'fraction', 'temp', 'xrpd', 'scientist_name', 'solute_lot_num', 'eln_sample_num_measure', 'file_name',];"></tr>
        </table>
        <div class="graph-container">
          <mat-form-field appearance="fill">
            <mat-label>Graph Type</mat-label>
            <mat-select [(ngModel)]="selectedGraphType" name="selectedGraphType">
              <mat-option  (click)="showGraph()" value="bar">Bar Graph</mat-option>
              <mat-option  (click)="showGraph()" value="scatter">Scatter Plot</mat-option>
            </mat-select>
          </mat-form-field>
          <!-- <button mat-raised-button class="graph-button" (click)="showGraph()">Graph It</button> -->
        </div>
        <div class="download-container">
            <button mat-raised-button class="download-button" (click)="exportToExcel(selectedItems)">Download</button>
        </div>
        <canvas id="chartCanvas"></canvas>
    </div>    
</div>


